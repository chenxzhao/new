<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>单词朗读者</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #f9fafb; min-height: 100vh; display: flex; flex-direction: column; }
    header { background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); padding: 16px; text-align: center; }
    h1 { color: #1f2937; font-size: 24px; font-weight: 600; }
    main { flex: 1; display: flex; flex-direction: column; }
    .chapter-container { display: none; position: fixed; top: 0; left: 0; bottom: 0; width: 240px; background: white; border-right: 1px solid #e5e7eb; padding: 16px; overflow-y: auto; z-index: 10; }
    .chapter-container.show { display: block; }
    .chapter-title { font-size: 18px; font-weight: 500; color: #4b5563; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; }
    .chapter-list { list-style: none; }
    .chapter-item { padding: 8px 12px; border-radius: 6px; margin-bottom: 4px; cursor: pointer; transition: background 0.2s; }
    .chapter-item:hover { background: #eff6ff; }
    .chapter-item.active { background: #dbeafe; color: #2563eb; font-weight: 500; }
    .word-card { max-width: 500px; width: 90%; margin: auto; background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 24px; text-align: center; }
    .current-word { font-size: 36px; font-weight: 700; color: #111827; margin-bottom: 8px; }
    .current-pronunciation { color: #6b7280; font-style: italic; font-size: 18px; margin-bottom: 16px; }
    .current-meaning { color: #4b5563; font-size: 16px; }
    footer { background: white; box-shadow: 0 -2px 4px rgba(0,0,0,0.05); padding: 12px; }
    .controls { max-width: 600px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
    .control-btn { width: 40px; height: 40px; border-radius: 50%; border: none; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: transform 0.1s; }
    .control-btn:active { transform: scale(0.9); }
    .play-btn { background: #2563eb; color: white; }
    .nav-btn { background: #f3f4f6; color: #4b5563; }
    .loop-controls { display: flex; align-items: center; gap: 8px; }
    .loop-text { font-size: 14px; color: #6b7280; }
    .loop-options { display: flex; gap: 4px; }
    .loop-option { padding: 4px 8px; border-radius: 4px; font-size: 12px; cursor: pointer; transition: background 0.2s; }
    .loop-option.active { background: #2563eb; color: white; }
    .loop-option:not(.active):hover { background: #eff6ff; }
    .mobile-loop-btn { background: #f3f4f6; color: #4b5563; }
    .mobile-loop-options { display: none; position: fixed; bottom: 70px; left: 50%; transform: translateX(-50%); background: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); padding: 12px; z-index: 5; }
    .mobile-loop-options.show { display: block; }
    @media (min-width: 768px) {
      main { flex-direction: row; }
      .chapter-container { display: block; position: static; }
      .close-chapter-btn, .mobile-loop-btn { display: none; }
    }
  </style>
  <link href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
</head>
<body>
  <header>
    <h1>单词朗读者</h1>
  </header>

  <main>
    <div id="chapterContainer" class="chapter-container">
      <div class="chapter-title">
        <span>章节列表</span>
        <button id="closeChapterBtn" class="close-chapter-btn">
          <i class="fa fa-times"></i>
        </button>
      </div>
      <ul id="chapterList" class="chapter-list"></ul>
    </div>

    <div class="word-display">
      <div id="wordCard" class="word-card">
        <h3 id="currentWord" class="current-word"></h3>
        <p id="currentPronunciation" class="current-pronunciation"></p>
        <p id="currentMeaning" class="current-meaning"></p>
      </div>
    </div>
  </main>

  <footer>
    <div class="controls">
      <button id="chapterBtn" class="control-btn nav-btn">
        <i class="fa fa-list"></i>
      </button>
      
      <div class="play-controls">
        <button id="prevBtn" class="control-btn nav-btn">
          <i class="fa fa-step-backward"></i>
        </button>
        <button id="playPauseBtn" class="control-btn play-btn">
          <i class="fa fa-play"></i>
        </button>
        <button id="nextBtn" class="control-btn nav-btn">
          <i class="fa fa-step-forward"></i>
        </button>
      </div>
      
      <div class="loop-controls desktop-loop">
        <span class="loop-text">循环:</span>
        <div id="loopOptions" class="loop-options">
          <span class="loop-option active" data-count="1">1次</span>
          <span class="loop-option" data-count="3">3次</span>
          <span class="loop-option" data-count="6">6次</span>
          <span class="loop-option" data-count="12">12次</span>
          <span class="loop-option" data-count="25">25次</span>
        </div>
      </div>
      
      <button id="mobileLoopBtn" class="control-btn mobile-loop-btn">
        <i class="fa fa-repeat"></i>
      </button>
    </div>
    
    <div id="mobileLoopOptions" class="mobile-loop-options">
      <div class="loop-options">
        <span class="loop-option active" data-count="1">1次</span>
        <span class="loop-option" data-count="3">3次</span>
        <span class="loop-option" data-count="6">6次</span>
        <span class="loop-option" data-count="12">12次</span>
        <span class="loop-option" data-count="25">25次</span>
      </div>
    </div>
  </footer>

  <script>
    const wordData = [
      {
        "chapter": "第一章：基础词汇",
        "words": [
          { "word": "apple", "pronunciation": "/ˈæpl/", "meaning": "n. 苹果" },
          { "word": "banana", "pronunciation": "/bəˈnɑːnə/", "meaning": "n. 香蕉" },
          { "word": "cat", "pronunciation": "/kæt/", "meaning": "n. 猫" },
          { "word": "dog", "pronunciation": "/dɒɡ/", "meaning": "n. 狗" }
        ]
      },
      {
        "chapter": "第二章：进阶词汇",
        "words": [
          { "word": "abandon", "pronunciation": "/əˈbændən/", "meaning": "v. 放弃；抛弃" },
          { "word": "ability", "pronunciation": "/əˈbɪləti/", "meaning": "n. 能力；才能" },
          { "word": "achieve", "pronunciation": "/əˈtʃiːv/", "meaning": "v. 达到；完成" }
        ]
      }
    ];

    const state = {
      currentChapterIndex: 0,
      currentWordIndex: 0,
      isPlaying: false,
      loopCount: 1,
      currentLoop: 0,
      speechSynthesis: window.speechSynthesis,
      currentUtterance: null
    };

    const $ = (id) => document.getElementById(id);
    const elements = {
      chapterList: $('chapterList'),
      chapterContainer: $('chapterContainer'),
      chapterBtn: $('chapterBtn'),
      closeChapterBtn: $('closeChapterBtn'),
      currentWord: $('currentWord'),
      currentPronunciation: $('currentPronunciation'),
      currentMeaning: $('currentMeaning'),
      playPauseBtn: $('playPauseBtn'),
      prevBtn: $('prevBtn'),
      nextBtn: $('nextBtn'),
      loopOptions: $('loopOptions'),
      mobileLoopBtn: $('mobileLoopBtn'),
      mobileLoopOptions: $('mobileLoopOptions')
    };

    function init() {
      renderChapters();
      renderCurrentWord();
      setupEventListeners();
    }

    function renderChapters() {
      elements.chapterList.innerHTML = '';
      wordData.forEach((chapter, index) => {
        const li = document.createElement('li');
        li.className = `chapter-item ${index === state.currentChapterIndex ? 'active' : ''}`;
        li.textContent = chapter.chapter;
        li.addEventListener('click', () => {
          state.currentChapterIndex = index;
          state.currentWordIndex = 0;
          renderChapters();
          renderCurrentWord();
          elements.chapterContainer.classList.remove('show');
        });
        elements.chapterList.appendChild(li);
      });
    }

    function renderCurrentWord() {
      const currentChapter = wordData[state.currentChapterIndex];
      const currentWord = currentChapter.words[state.currentWordIndex];
      elements.currentWord.textContent = currentWord.word;
      elements.currentPronunciation.textContent = currentWord.pronunciation;
      elements.currentMeaning.textContent = currentWord.meaning;
    }

    // 使用Web Speech API合成并播放
    function synthesizeAndPlay() {
      if (!state.speechSynthesis) {
        alert('您的浏览器不支持语音合成功能');
        return;
      }

      const currentWord = wordData[state.currentChapterIndex].words[state.currentWordIndex].word;

      try {
        // 取消之前的播放
        state.speechSynthesis.cancel();
        
        // 创建语音合成实例
        const utterance = new SpeechSynthesisUtterance(currentWord);
        utterance.lang = 'en-US'; // 英语发音
        utterance.rate = 0.9; // 语速
        utterance.volume = 1; // 音量

        // 语音合成结束事件
        utterance.onend = () => {
          state.currentLoop++;
          if (state.currentLoop < state.loopCount) {
            // 继续循环当前单词
            state.speechSynthesis.speak(utterance);
          } else {
            // 循环完成，播放下一个
            playNextWord();
          }
        };

        // 保存当前语音实例
        state.currentUtterance = utterance;
        
        // 开始播放
        state.speechSynthesis.speak(utterance);
      } catch (error) {
        console.error('语音合成错误:', error);
        alert('语音合成失败，请重试');
        stopPlayback();
      }
    }

    function startPlayback() {
      if (state.isPlaying) return;
      
      state.isPlaying = true;
      elements.playPauseBtn.innerHTML = '<i class="fa fa-pause"></i>';
      state.currentLoop = 0;
      synthesizeAndPlay();
    }

    function stopPlayback() {
      state.isPlaying = false;
      elements.playPauseBtn.innerHTML = '<i class="fa fa-play"></i>';
      
      // 停止当前播放
      if (state.speechSynthesis) {
        state.speechSynthesis.cancel();
      }
      state.currentUtterance = null;
    }

    function playNextWord() {
      const currentChapter = wordData[state.currentChapterIndex];
      state.currentWordIndex = (state.currentWordIndex + 1) % currentChapter.words.length;
      
      if (state.currentWordIndex === 0) {
        state.currentChapterIndex = (state.currentChapterIndex + 1) % wordData.length;
        renderChapters();
      }
      
      renderCurrentWord();
      state.currentLoop = 0;
      
      if (state.isPlaying) {
        synthesizeAndPlay();
      }
    }

    function playPrevWord() {
      const currentChapter = wordData[state.currentChapterIndex];
      state.currentWordIndex = (state.currentWordIndex - 1 + currentChapter.words.length) % currentChapter.words.length;
      
      if (state.currentWordIndex === currentChapter.words.length - 1) {
        state.currentChapterIndex = (state.currentChapterIndex - 1 + wordData.length) % wordData.length;
        renderChapters();
      }
      
      renderCurrentWord();
      state.currentLoop = 0;
      
      if (state.isPlaying) {
        synthesizeAndPlay();
      }
    }

    function setupEventListeners() {
      // 播放/暂停按钮
      elements.playPauseBtn.addEventListener('click', () => {
        if (state.isPlaying) {
          stopPlayback();
        } else {
          startPlayback();
        }
      });

      // 上一个/下一个按钮
      elements.prevBtn.addEventListener('click', playPrevWord);
      elements.nextBtn.addEventListener('click', playNextWord);

      // 章节切换
      elements.chapterBtn.addEventListener('click', () => {
        elements.chapterContainer.classList.add('show');
      });
      
      elements.closeChapterBtn.addEventListener('click', () => {
        elements.chapterContainer.classList.remove('show');
      });

      // 循环次数选择
      const loopOptions = [...elements.loopOptions.querySelectorAll('.loop-option'), ...elements.mobileLoopOptions.querySelectorAll('.loop-option')];
      loopOptions.forEach(option => {
        option.addEventListener('click', (e) => {
          loopOptions.forEach(o => o.classList.remove('active'));
          e.target.classList.add('active');
          state.loopCount = parseInt(e.target.dataset.count);
          elements.mobileLoopOptions.classList.remove('show');
        });
      });

      // 移动端循环按钮
      elements.mobileLoopBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        elements.mobileLoopOptions.classList.toggle('show');
      });

      // 点击空白处关闭移动端循环选项
      document.addEventListener('click', (e) => {
        if (!elements.mobileLoopBtn.contains(e.target) && !elements.mobileLoopOptions.contains(e.target)) {
          elements.mobileLoopOptions.classList.remove('show');
        }
      });
    }

    // 初始化应用
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>